machine:
  services:
    - docker

dependencies:
  override:
    - docker info

test:
  override:
    - ./alpine-go-1.7-1.8-template/build.sh
    - ./alpine-go-template/build.sh
    - ./brew-go/build.sh
    - ./go-1.7-1.8-template/build.sh
    - ./go-rpm-fpm-template/build.sh
  post:
    - |
      SUBDIRS=$(echo */)
      for currDir in $SUBDIRS; do
        currImagesDir="${currDir}images/" && \
        if [ -d "$currImagesDir" ]; then
          mkdir -p "$CIRCLE_ARTIFACTS/$currDir" && \
          cp -r "$currImagesDir"* "$CIRCLE_ARTIFACTS/$currDir"
        fi
      done
deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - ./publish-tags.sh
